modelo1 <- felm(drate ~ unilateral | st + year,
data = wd,
weights = wd$stpop)
summary(modelo1)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1967 & year<1989 & sex==2)
#Asumiendo tendencias paralelas
modelo1 <- felm(drate ~ unilateral | st + year,
data = wd,
weights = wd$stpop)
summary(modelo1)
wolfers.data <-read_csv("wolfers_divorce.csv",
locale = locale(encoding = "latin1")) %>%
select(div_rate, unilateral, st, year, stpop, divx)  %>%
filter(year>1967 & year<1989)
#DID hasta antes de Bacon---
wolfers.data <-read_csv("./content/notas/wolfers_divorce.csv",
locale = locale(encoding = "latin1")) %>%
select(div_rate, unilateral, st, year, stpop, divx)  %>%
filter(year>1967 & year<1989)
#Asumiendo tendencias paralelas
modelo1 <- felm(drate ~ unilateral | st + year,
data = wd,
weights = wd$stpop)
summary(modelo1)
#Esto genera una aplicación interactiva
ExPanD(df = wolfers.data,
ts_id="year",
cs_id="st",
title = "Wow, mis datos",
abstract = "Datos tomados de Wolfers (2006), Did Unilateral Divorce Laws Rase Divorce Rates?")
modelo1 <- felm(div_rate ~unilateral | st + year,
data = wolfers.data,
weights = wolfers.data$stpop)
summary(modelo1)
#Asumiendo tendencias paralelas
modelo1 <- felm(div_rate ~unilateral | st + year + + divx,
data = wolfers.data,
weights = wolfers.data$stpop)
summary(modelo1)
modelo1 <- felm(div_rate ~unilateral | st + year +,
#Asumiendo tendencias paralelas
modelo1 <- felm(div_rate ~unilateral | st + year,
data = wolfers.data)
summary(modelo1)
modelo2 <- felm(div_rate ~unilateral | factor(st) + factor(year) + factor(st):year,
data = wolfers.data)
summary(modelo2)
modelo3a <- felm(div_rate ~unilateral |
factor(st)+factor(year)+year:factor(st) |
0 |
st,
data = wolfers.data)
summary(modelo3a)
View(a)
View(a)
View(wd)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1969 & year<1985 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare))
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | st + year,
data = wolfers.data)
wd <- divorce %>%
filter(year>1969 & year<1985 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare))
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | st + year,
data = wd)
summary(modelo1)
a <- filter(wd, st=="AK" & year==1960)
a <- filter(wd, st=="AK" & year==19701)
a <- filter(wd, st=="AK" & year==1970)
a <- filter(divorce, st=="AK" & year==19701)
a <- filter(divorce, st=="AK" & year==19701)
a <- filter(divorce, st=="AK" & year==1970)
View(a)
View(a)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1969 & year<1985) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare))
a <- filter(wd, st=="AK" & year==1970)
View(a)
View(a)
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | st + year,
data = wd)
summary(modelo1)
#Asumiendo tendencias paralelas
modelo1 <- felm(suicrt ~ unilateral | st + year,
data = wd)
summary(modelo1)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1969 & year<1985) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare)) %>%
mutate(suicrt=suicrt*100)
#Asumiendo tendencias paralelas
modelo1 <- felm(suicrt ~ unilateral | st + year,
data = wd)
summary(modelo1)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1969 & year<1985) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare)) %>%
mutate(suicrt=suicrt*1000)
#Asumiendo tendencias paralelas
modelo1 <- felm(suicrt ~ unilateral | st + year,
data = wd)
summary(modelo1)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1969 & year<1985) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare))
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1969 & year<1985) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare)) %>%
mutate(suicrt=exp(suicrt))
#Asumiendo tendencias paralelas
modelo1 <- felm(suicrt ~ unilateral | st + year,
data = wd)
summary(modelo1)
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | st + year,
data = wd)
summary(modelo1)
wd <- divorce %>%
filter(year>1969 & year<1985) %>%
mutate(suicide_rate=suicide*10000000/(stpop*fshare)) %>%
mutate(suicrt=exp(suicrt))
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | st + year,
data = wd)
summary(modelo1)
summary(wd$suicide_rate)
wd <- divorce %>%
filter(year>1969 & year<1985) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare)) %>%
mutate(suicrt=exp(suicrt))
summary(wd$suicide_rate)
summary(wd$suicrt)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1969 & year<1985) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare)) %>%
mutate(suicrt))
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1969 & year<1985) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare))
summary(wd$suicrt)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1969 & year<1985 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare))
summary(wd$suicrt)
summary(wd$suicide_rate)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare))
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | st + year,
data = wd)
summary(modelo1)
summary(wd$suicrt)
summary(wd$suicide_rate)
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare2))
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | st + year,
data = wd)
summary(modelo1)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare))
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | st + year,
data = wd)
summary(modelo1)
modelo1 <- felm(suicide_rate ~ unilateral | factor(st) + factor(year),
data = wd)
summary(modelo1)
modelo2 <- felm(suicide_rate ~ unilateral | factor(st) + factor(year) + factor(st):year,
data = wd)
class(wd$year)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare),
year=numeric(year))
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare),
year=as.numeric(year))
modelo2 <- felm(suicide_rate ~ unilateral | factor(st) + factor(year) + factor(st):year,
data = wd)
summary(modelo2)
modelo1 <- felm(suicide_rate ~ unilateral | factor(st) + factor(year),
data = wd)
summary(modelo1)
modelo2 <- felm(suicide_rate ~ unilateral | factor(st) + factor(year) + factor(st):year,
data = wd)
summary(modelo2)
#Recordemos agrupar los errores
modelo1a <- felm(suicide_rate ~ unilateral | factor(st) + factor(year) | 0 | st,
data = wd)
summary(modelo1a)
summary(modelo1)
modelo2a <- felm(suicide_rate ~ unilateral | factor(st) + factor(year) + factor(st):year | 0 | st,
data = wd)
summary(modelo2a)
df_bacon <- bacon(suicide_rate ~ unilateral,
data = wd,
id_var = "st",
time_var = "year")
coef_bacon <- sum(df_bacon$estimate * df_bacon$weight)
print(paste("Weighted sum of decomposition =", round(coef_bacon, 4)))
fit_tw <- lm(suicrt ~ unilateral + factor(st) + factor(year),
data = wd)
print(paste("Two-way FE estimate =", round(fit_tw$coefficients[2], 4)))
df_bacon <- bacon(suicide_rate ~ unilateral,
data = wd,
id_var = "st",
time_var = "year")
coef_bacon <- sum(df_bacon$estimate * df_bacon$weight)
print(paste("Weighted sum of decomposition =", round(coef_bacon, 4)))
fit_tw <- lm(suicide_rate ~ unilateral + factor(st) + factor(year),
data = wd)
print(paste("Two-way FE estimate =", round(fit_tw$coefficients[2], 4)))
df_bacon %>%
ggplot(aes(x=weight,
y=estimate,
color=type)) +
geom_point()
df_bacon %>%
ggplot(aes(x=weight,
y=estimate,
color=type)) +
geom_point() +
geom_hline(yintercept = round(fit_tw$coefficients[2], 4) )
install.packages("fixest")
library(fixest)
?fixest
?felm
set.seed(123456L)
# 60 time periods, 30 individuals, and 5 waves of treatment
tmax = 60; imax = 30; nlvls = 5
dat =
expand.grid(time = 1:tmax, id = 1:imax) |>
within({
cohort      = NA
effect      = NA
first_treat = NA
for (chrt in 1:imax) {
cohort = ifelse(id==chrt, sample.int(nlvls, 1), cohort)
}
for (lvls in 1:nlvls) {
effect      = ifelse(cohort==lvls, sample(2:10, 1), effect)
first_treat = ifelse(cohort==lvls, sample(1:(tmax+20), 1), first_treat)
}
first_treat = ifelse(first_treat>tmax, Inf, first_treat)
treat       = time>=first_treat
rel_time    = time - first_treat
y           = id + time + ifelse(treat, effect*rel_time, 0) + rnorm(imax*tmax)
rm(chrt, lvls, cohort, effect)
})
head(dat)
View(dat)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare),
year=as.numeric(year)) %>%
select(st, suicide_rate, unilateral)
View(wd)
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | factor(st) + factor(year),
data = wd)
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare),
year=as.numeric(year)) %>%
select(st, year, suicide_rate, unilateral)
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | factor(st) + factor(year),
data = wd)
summary(modelo1)
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare),
year=as.numeric(year))
View(wd)
View(wd)
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare),
year=as.numeric(year)) %>%
select(st, year, suicide_rate, unilateral, divyear)
wd <- wd %>%
mutate(t_desde_t = year-divyear)
modeloSA <-  feols(suicide_rate ~ sunab(divyear, periodos_desde_t) | st + year,
data = wd,
vcov = ~st)
wd <- wd %>%
mutate(periodos_desde_t = year-divyear)
modeloSA <-  feols(suicide_rate ~ sunab(divyear, periodos_desde_t) | st + year,
data = wd,
vcov = ~st)
modeloSA
summary(modeloSA)
install.packages(lattice)
install.packages('lattice')
install.packages("lattice")
# Some (optional!) plot theme settings
xyplot(suicide_rate ~ year,
groups = st,
type = c("l", "g"),
ylab = "Y",
xlab = "Time variable",
data = wd)
library(lattice)
# Some (optional!) plot theme settings
xyplot(suicide_rate ~ year,
groups = st,
type = c("l", "g"),
ylab = "Y",
xlab = "Time variable",
data = wd)
install.packages('ggiplot')
library(iplot)
install.packages('plot')
install.packages('iplot')
#Gráfico
iplot(modeloSA)
modeloSA |>
iplot(
main     = "fixest::sunab",
xlab     = "Time to treatment",
drop     = "[[:digit:]]{2}",    # Limit lead and lag periods to -9:9
ref.line = 1
)
modeloSA %>%
iplot(
main     = "fixest::sunab",
xlab     = "Time to treatment",
drop     = "[[:digit:]]{2}",    # Limit lead and lag periods to -9:9
ref.line = 1
)
?iplot
View(modeloSA)
View(modeloSA)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
drop = "periodos_desde_t<-7",    #
ref.line = 1)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
drop = "x[[]]<-7",
ref.line = 1)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
drop = "x<-7",
ref.line = 1)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
drop = x<-7,
ref.line = 1)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
drop = "x[[.]]<-7",
ref.line = 1)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
drop = "x[[]]<-7",
ref.line = 1)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
drop = "x[[:digit:]]{2}",   #quita los periodos de dos dígitos
ref.line = 1)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
drop = "x[[:digit:]]{2}",   #quita los periodos de dos dígitos
ref.line = 1)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
drop = "[[:digit:]]{2}",   #quita los periodos de dos dígitos
ref.line = 1)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
drop = "periodos_desde_t[[:digit:]]{2}",   #quita los periodos de dos dígitos
ref.line = 1)
#DID abortion laws in Mexico
rm(list = ls())
options(scipen=999)
library(tidyverse)
library(janitor)
library(clubSandwich)
library(ExPanDaR) #for describing panel data
library(bacondecomp)
library(fixest) #incluye el estimador de SA y el correspondiente gráfico de evento
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare),
year=as.numeric(year)) %>%
select(st, year, suicide_rate, unilateral, divyear)
#Asumiendo tendencias paralelas
modelo1 <- felm(suicide_rate ~ unilateral | factor(st) + factor(year),
data = wd)
summary(modelo1)
#Frecuentemente se usaban "tendencias específicas
modelo2 <- felm(suicide_rate ~ unilateral | factor(st) + factor(year) + factor(st):year,
data = wd)
summary(modelo2)
#Recordemos agrupar los errores
modelo1a <- felm(suicide_rate ~ unilateral | factor(st) + factor(year) | 0 | st,
data = wd)
summary(modelo1a)
modelo2a <- felm(suicide_rate ~ unilateral | factor(st) + factor(year) + factor(st):year | 0 | st,
data = wd)
summary(modelo2a)
df_bacon <- bacon(suicide_rate ~ unilateral,
data = wd,
id_var = "st",
time_var = "year")
coef_bacon <- sum(df_bacon$estimate * df_bacon$weight)
print(paste("Weighted sum of decomposition =", round(coef_bacon, 4)))
fit_tw <- lm(suicide_rate ~ unilateral + factor(st) + factor(year),
data = wd)
print(paste("Two-way FE estimate =", round(fit_tw$coefficients[2], 4)))
#Replicamos la figura 6 en Goodman-Bacon (2021)
df_bacon %>%
ggplot(aes(x=weight,
y=estimate,
color=type)) +
geom_point() +
geom_hline(yintercept = round(fit_tw$coefficients[2], 4))
#Estimador de Sun y Abraham (2020)----
#Definimos: periodos_desde_t: periodos desde el tratamiento (negativo antes del tratamiento)
wd <- wd %>%
mutate(periodos_desde_t = year-divyear)
modeloSA <-  feols(suicide_rate ~ sunab(divyear, periodos_desde_t) | st + year,
data = wd,
vcov = ~st)
summary(modeloSA)
#Gráfico (iplot está incluido en fixest)
iplot(modeloSA)
modeloSA %>%
iplot(main = "fixest::sunab",
xlab = "Periodos desde el tratamiento",
ref.line = 1)
#Esta es una de las funciones de ExPanDaR para explorar datos faltantes
panel_missing <- prepare_missing_values_graph(wd, ts_id = "year")
View(panel_missing)
View(panel_missing)
View(panel_missing)
View(panel_missing)
ExPanD(df = wd,
ts_id="year",
cs_id="st",
title = "Wow, mis datos",
abstract = "Datos tomados de Wolfers (2006), Did Unilateral Divorce Laws Rase Divorce Rates?")
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare),
year=as.numeric(year))
View(wd)
View(wd)
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare),
year=as.numeric(year)) %>%
select(st, year, suicide_rate, unilateral, divyear, drate, stpop)
#Explorar datos en panel----
#Esta es una de las funciones de ExPanDaR para explorar datos faltantes
panel_missing <- prepare_missing_values_graph(wd, ts_id = "year")
prepare_missing_values_graph(wd, ts_id = "year")
#Datos contenidos en el paquete bacondecomp
wd <- divorce %>%
filter(year>1964 & year<1996 & sex==2) %>%
mutate(suicide_rate=suicide*1000000/(stpop*fshare),
year=as.numeric(year))
#Esto genera una aplicación interactiva
ExPanD(df = wd,
ts_id="year",
cs_id="st",
title = "Wow, mis datos",
abstract = "Datos tomados de Wolfers (2006), Did Unilateral Divorce Laws Rase Divorce Rates?")
ExPanD(df = wd,
ts_id="year",
cs_id="st",
title = "Wow, mis datos",
abstract = "Datos tomados de Wolfers (2006), Did Unilateral Divorce Laws Rase Divorce Rates?")
