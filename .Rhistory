?rdrobust
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer),
vce = 'hc0'))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer),
vce = 'hc3'))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer),
vce = 'hc3',
all = T))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ ifh_norm*abajo_corte + I(ifh_norm^2)*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después
summary(lm(hospinter ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ ifh_norm*abajo_corte + I(ifh_norm^2)*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer),
vce = 'hc3',
all = T))
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
library(readr)
library(rdrobust)
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv") %>%
filter(formal==0) %>%
mutate(ifh_norm=ifh-corte,
abajo_corte=ifelse(ifh<=corte, 1, 0))
(rdplot(y = salud$curative,
x = salud$score_norm,
c=0,
p=1))
(rdplot(y = salud$curative,
x = salud$ifh_norm,
c=0,
p=1))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
vce = 'hc3',
all = T))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer),
vce = 'hc3',
all = T))
knitr::opts_chunk$set(echo = T, warning = F, message = F)
library(tidyverse)
library(janitor)
library(clubSandwich)
library(modelsummary)
library(MatchIt)
library(Zelig)
devtools::install_github('IQSS/Zelig')
knitr::opts_chunk$set(echo = T, warning = F, message = F)
library(tidyverse)
library(janitor)
library(clubSandwich)
library(modelsummary)
library(MatchIt)
library(Zelig)
data.smoking<-read_csv(
"./cattaneo_smoking.csv",
locale = locale(encoding = "latin1")) %>%
clean_names() %>%
mutate(smoke=ifelse(mbsmoke=="smoker",1,0)) %>%
mutate(married=ifelse(mmarried=="married",1,0)) %>%
mutate(firstbaby=ifelse(fbaby=="Yes",1,0))
#Asegurarse que no hay NA, matchit no acepta NA
data.smoking <- data.smoking[complete.cases(data.smoking), ]
#Una semilla para todo el trabajo
set.seed(1021)
datasummary_balance(~smoke,
fmt = "%.2f",
data = select(data.smoking),
dinm_statistic = "p.value"
title = "Pruebas de balance",
datasummary_balance(~smoke,
fmt = "%.2f",
data = select(data.smoking),
dinm_statistic = "p.value",
title = "Pruebas de balance",
notes = "Fuente: Cattaneo (2009)")
datasummary_balance(~smoke,
fmt = "%.2f",
data = select(data.smoking, married, firstbaby, medu, nprenatal, foreign, mhisp, fage),
dinm_statistic = "p.value",
title = "Pruebas de balance",
notes = "Fuente: Cattaneo (2009)")
datasummary_balance(~smoke,
fmt = "%.2f",
data = select(data.smoking, smoke, married, firstbaby, medu, nprenatal, foreign, mhisp, fage),
dinm_statistic = "p.value",
title = "Pruebas de balance",
notes = "Fuente: Cattaneo (2009)")
binaria <- "smoke"
variables <- c("married", "firstbaby", "medu", "nprenatal", "foreign", "mhisp", "fage")
ps <- as.formula(paste(binaria,
paste(variables,
collapse ="+"),
sep= " ~ "))
print(ps)
m.out <- matchit(formula=ps,
method = "nearest",
ratio = 1,
distance= "logit",
replace = FALSE,
data = data.smoking)
summary(m.out)
plot(m.out, type = "jitter")
plot(m.out, type = "hist")
m.data <- match.data(m.out)
head(m.out$match.matrix)
z.out <- zelig(bweight~smoke,
data = m.data,
model = "ls")
z.out
summary(lm(bweight ~ smoke,
data = m.data))
library(cobalt)
love.plot(bal.tab(m.out),
threshold = .1)
blogdown:::preview_site()
knitr::opts_chunk$set(echo = T, warning = F, message = F)
library(tidyverse)
library(janitor)
library(clubSandwich)
library(modelsummary)
library(MatchIt)
library(Zelig)
library(cobalt)
data.smoking<-read_csv(
"./cattaneo_smoking.csv",
locale = locale(encoding = "latin1")) %>%
clean_names() %>%
mutate(smoke=ifelse(mbsmoke=="smoker",1,0)) %>%
mutate(married=ifelse(mmarried=="married",1,0)) %>%
mutate(firstbaby=ifelse(fbaby=="Yes",1,0))
#Asegurarse que no hay NA, matchit no acepta NA
data.smoking <- data.smoking[complete.cases(data.smoking), ]
#Una semilla para todo el trabajo
set.seed(1021)
datasummary_balance(~smoke,
fmt = "%.2f",
data = select(data.smoking, smoke, married, firstbaby, medu, nprenatal, foreign, mhisp, fage),
dinm_statistic = "p.value",
title = "Pruebas de balance",
notes = "Fuente: Cattaneo (2009)")
binaria <- "smoke"
variables <- c("married", "firstbaby", "medu", "nprenatal", "foreign", "mhisp", "fage")
ps <- as.formula(paste(binaria,
paste(variables,
collapse ="+"),
sep= " ~ "))
print(ps)
m.out <- matchit(formula=ps,
method = "nearest",
ratio = 1,
distance= "logit",
replace = FALSE,
data = data.smoking)
summary(m.out)
plot(m.out, type = "jitter")
plot(m.out, type = "hist")
m.data <- match.data(m.out)
head(m.out$match.matrix)
love.plot(bal.tab(m.out),
threshold = .1)
tt1 <- lm(bweight ~ smoke,
data = m.data,
weights = weights)
#Cluster-robust standard errors
coeftest(tt1,
vcov. = vcovCL,
cluster = ~subclass)
library(lmtest)
tt1 <- lm(bweight ~ smoke,
data = m.data,
weights = weights)
#Cluster-robust standard errors
coeftest(tt1,
vcov. = vcovCL,
cluster = ~subclass)
library(sandwich)
tt1 <- lm(bweight ~ smoke,
data = m.data,
weights = weights)
#Cluster-robust standard errors
coeftest(tt1,
vcov. = vcovCL,
cluster = ~subclass)
m.data
a <- m.data
View(a)
View(a)
tt2 <- lm(bweight ~ smoke + married + firstbaby + medu + nprenatal + foreign + mhisp + fage,
data = m.data,
weights = weights)
#Errores agrupados a nivel subclass
coeftest(tt2,
vcov. = vcovCL,
cluster = ~subclass)
m.out <- matchit(formula=ps,
method = "nearest",
distance= "logit",
replace = FALSE,
ratio = 2,
caliper = .1,
data = data.smoking)
m.data <- match.data(m.out)
head(m.out$match.matrix)
love.plot(bal.tab(m.out),
threshold = .1)
tt1 <- lm(bweight ~ smoke,
data = m.data,
weights = weights)
#Errores agrupados a nivel subclass
coeftest(tt1,
vcov. = vcovCL,
cluster = ~subclass)
View(m.data)
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
library(janitor)
library(sandwich)
library(clubSandwich)
library(modelsummary)
library(MatchIt)
library(Zelig)
library(cobalt)
library(lmtest)
#Datos
data.smoking <- read_csv(
"./cattaneo_smoking.csv",
locale = locale(encoding = "latin1")) %>%
clean_names() %>%
mutate(smoke=ifelse(mbsmoke=="smoker",1,0)) %>%
mutate(married=ifelse(mmarried=="married",1,0)) %>%
mutate(firstbaby=ifelse(fbaby=="Yes",1,0))
data.smoking <- read_csv(
"./content/notas/cattaneo_smoking.csv",
locale = locale(encoding = "latin1")) %>%
clean_names() %>%
mutate(smoke=ifelse(mbsmoke=="smoker",1,0)) %>%
mutate(married=ifelse(mmarried=="married",1,0)) %>%
mutate(firstbaby=ifelse(fbaby=="Yes",1,0))
View(data.smoking)
m.out <- matchit(formula=ps,
method = "nearest",
ratio = 1,
distance= "logit",
replace = FALSE,
data = data.smoking)
#Nuestro modelo para el PS----
binaria <- "smoke"
variables <- c("married", "firstbaby", "medu", "nprenatal", "foreign", "mhisp", "fage")
ps <- as.formula(paste(binaria,
paste(variables,
collapse ="+"),
sep= " ~ "))
print(ps)
#Estimación del PS
ps.est <- glm(formula = ps,
family = binomial(link = "logit"),
data = data.smoking)
#El PS estimado es la probabilidad ajustada
data.smoking <- data.smoking %>%
mutate(ps_hat = predict(ps.est, type = "response"))
data.smoking %>%
ggplot(aes(x = ps_hat)) +
geom_histogram(aes(y=..density..), colour="black", fill="white")+
facet_wrap(~smoke) +
xlab("Probabilidad de fumar") +
theme_bw()
#Usaremos la función matchit para hacer el apareamiento----
m.out <- matchit(formula=ps,
method = "nearest",
ratio = 1,
distance= "logit",
replace = FALSE,
data = data.smoking)
summary(m.out)
#Con match.data obtenemos la muestra apareada
m.data <- match.data(m.out)
View(m.data)
View(m.data)
??RDHonest
??gtsummary
knitr::opts_chunk$set(echo = FALSE, fig.path = "figures/")
library(tidyverse)
library(janitor)
library(sandwich)
library(clubSandwich)
library(modelsummary)
library(stargazer)
library(rdrobust)
xfun::pkg_load2(c('base64enc', 'htmltools', 'mime'))
data.brasil<-read_csv(
"./brazil_runner_up.csv",
locale = locale(encoding = "latin1"))
View(data.brasil)
data.brasil %>%
select(run, cand_ran_again, cand_winner) %>%
tbl_summary(statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"),
digits = all_continuous() ~ 2,
label = run ~ "Diferencia de votos",
missing_text = "(Missing)")
??tbl_summary
library(gtsummary)
install.packages('gtsummary')
library(gtsummary)
data.brasil %>%
select(run, cand_ran_again, cand_winner) %>%
tbl_summary(statistic = list(all_continuous() ~ "{mean} ({sd})",
all_categorical() ~ "{n} / {N} ({p}%)"),
digits = all_continuous() ~ 2,
label = run ~ "Diferencia de votos",
missing_text = "(Missing)")
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_vline(xintercept=0, linetype="dashed", color = "red", size=1)
data.brasil %>%
ggplot(aes(x=run,y=cand_ran_again))+
geom_point()+
geom_vline(xintercept=0, linetype="dashed", color = "red", size=1)
m1 <- lm(cand_ran_again ~ run+I(run^2),
data=subset(data.brasil,run>-48 & run<0))
m2 <- lm(cand_ran_again ~ run+I(run^2),
data=subset(data.brasil,run>=0 & run<48))
data.brasil <- data.brasil %>%
mutate(cand_ran_again_hat_left=ifelse(run>-48 & run<0,predict(m1,.),NA)) %>%
mutate(cand_ran_again_hat_right=ifelse(run>=0 & run<48,predict(m2,.),NA))
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_vline(xintercept=0, linetype="dashed", color = "red", size=1)+
geom_line(aes(x=run, y=cand_ran_again_hat_left))
#Con los dos segmentos
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_vline(xintercept=0, linetype="dashed", color = "red", size=1)+
geom_line(aes(x=run, y=cand_ran_again_hat_left))+
geom_line(aes(x=run, y=cand_ran_again_hat_right))
?ggplot
?geom_smooth
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_smooth(data = filter(data.brasil, run>-48 & run<0),
method = "lm")
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_smooth(data = filter(data.brasil, run>-48 & run<0),
method = "lm",
formula = y ~ poly(x, 2))+
geom_smooth(data = filter(data.brasil, run>=0 & run<48),
method = "lm")
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_smooth(data = filter(data.brasil, run>-48 & run<0),
method = "lm",
formula = y ~ poly(x, 2))+
geom_smooth(data = filter(data.brasil, run>=0 & run<48),
method = "lm",
formula = y ~ poly(x, 2)))
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_smooth(data = filter(data.brasil, run>-48 & run<0),
method = "lm",
formula = y ~ poly(x, 2))+
geom_smooth(data = filter(data.brasil, run>=0 & run<48),
method = "lm",
formula = y ~ poly(x, 2))
w1 <- lm(bin_cand_winner ~ run+I(run^2), data=subset(data.brasil,run>-48 & run<0))
w2 <- lm(bin_cand_winner ~ run+I(run^2), data=subset(data.brasil,run>=0 & run<48))
data.brasil <- data.brasil %>%
mutate(cand_win_hat_left=ifelse(run>-48 & run<0,predict(w1,.),NA)) %>%
mutate(cand_win_hat_right=ifelse(run>=0 & run<48,predict(w2,.),NA))
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_winner))+
geom_point()+
geom_vline(xintercept=0, linetype="dashed", color = "red", size=1)+
geom_line(aes(x=run, y=cand_win_hat_left))+
geom_line(aes(x=run, y=cand_win_hat_right))
data.brasil %>%
filter(bin_cand_ran_again<.55 , bin_cand_winner <.55) %>%
ggplot()+
geom_point(aes(x=bin_run,y=bin_cand_ran_again),shape=17,fill="black")+
geom_point(aes(x=bin_run,y=bin_cand_winner))+
geom_line(aes(x=run, y=cand_win_hat_left))+
geom_line(aes(x=run, y=cand_win_hat_right))+
geom_line(aes(x=run, y=cand_ran_again_hat_left))+
geom_line(aes(x=run, y=cand_ran_again_hat_right))+
geom_vline(xintercept=0, color = "black", size=1)+
xlab("Vote Share Difference Between 2nd and 3rd; t (%)")+
ylab("")+
scale_x_continuous(breaks = c(-50,0,50))+
scale_y_continuous(breaks=seq(0, 0.5, 0.05))
w1 <- lm(bin_cand_winner ~ run+I(run^2), data=subset(data.brasil,run>-48 & run<0))
w2 <- lm(bin_cand_winner ~ run+I(run^2), data=subset(data.brasil,run>=0 & run<48))
data.brasil <- data.brasil %>%
mutate(cand_win_hat_left=ifelse(run>-48 & run<0,predict(w1,.),NA)) %>%
mutate(cand_win_hat_right=ifelse(run>=0 & run<48,predict(w2,.),NA))
data.brasil %>%
filter(bin_cand_ran_again<.55 , bin_cand_winner <.55) %>%
ggplot()+
geom_point(aes(x=bin_run,y=bin_cand_ran_again),shape=17,fill="black")+
geom_point(aes(x=bin_run,y=bin_cand_winner))+
geom_line(aes(x=run, y=cand_win_hat_left))+
geom_line(aes(x=run, y=cand_win_hat_right))+
geom_line(aes(x=run, y=cand_ran_again_hat_left))+
geom_line(aes(x=run, y=cand_ran_again_hat_right))+
geom_vline(xintercept=0, color = "black", size=1)+
xlab("Vote Share Difference Between 2nd and 3rd; t (%)")+
ylab("")+
scale_x_continuous(breaks = c(-50,0,50))+
scale_y_continuous(breaks=seq(0, 0.5, 0.05))
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_smooth(data = filter(data.brasil, run>-48 & run<0),
method = "loess") +
geom_smooth(data = filter(data.brasil, run>=0 & run<48),
method = "loess"))
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_smooth(data = filter(data.brasil, run>-48 & run<0),
method = "loess") +
geom_smooth(data = filter(data.brasil, run>=0 & run<48),
method = "loess")
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_smooth(data = filter(data.brasil, run>-48 & run<0),
method = "lm",
formula = y ~ poly(x, 2))+
geom_smooth(data = filter(data.brasil, run>=0 & run<48),
method = "lm",
formula = y ~ poly(x, 2))
data.brasil %>%
ggplot(aes(x=bin_run,y=bin_cand_ran_again))+
geom_point()+
geom_smooth(data = filter(data.brasil, run>-48 & run<0),
method = "loess") +
geom_smooth(data = filter(data.brasil, run>=0 & run<48),
method = "loess")
perc.vars <- c( "cand_ran_again", "cand_winner", "cand_ran_lag", "cand_winner_lag", "cand_maj_party", "party_winner", "party_ran_again")
data.brasil[perc.vars] <- lapply(data.brasil[perc.vars],
function(x) x*100)
data.brasil <- data.brasil %>%
mutate(D=ifelse(run>0,1,0))
y ~ x1 x2 | EFECTOS FIJOS | INSTRUMENTOS | CLUSTER
sumary(rd1 <- felm(cand_winner ~ D  + run |0 | 0 | id_munic, data=data.brasil))
summary(rd1 <- felm(cand_winner ~ D  + run |0 | 0 | id_munic, data=data.brasil))
library(lfe)
summary(rd1 <- felm(cand_winner ~ D  + run |0 | 0 | id_munic, data=data.brasil))
summary(rd2 <- felm(cand_winner ~ D + run+I(run^2) |0 | 0 | id_munic, data=data.brasil))
summary(rd3 <- felm(cand_winner ~ D  + run + run*D |0 | 0 | id_munic,) data=data.brasil)
summary(rd3 <- felm(cand_winner ~ D  + run + run*D |0 | 0 | id_munic) data=data.brasil)
summary(rd3 <- felm(cand_winner ~ D  + run + run*D |0 | 0 | id_munic,
data=data.brasil)
summary(rd4 <- felm(cand_winner ~ D  + run + I(run^2) + run*D + I(run^2)*D |0 | 0 | id_munic,
summary(rd3 <- felm(cand_winner ~ D  + run + run*D |0 | 0 | id_munic,
data=data.brasil))
summary(rd4 <- felm(cand_winner ~ D  + run + I(run^2) + run*D + I(run^2)*D |0 | 0 | id_munic,
data=data.brasil))
stargazer(rd1, rd2, rd3, rd4,
title="Comparación de especificaciones de RD", type="text",
df=FALSE, digits=2)
rdres <- rdplot(y = data.brasil$cand_winner, x = data.brasil$run, title = "Efecto seguidor",
y.label = "Probabilidad de ganar en t+1",
x.label = "Distancia con respecto al 3er lugar en t")
rdres <- rdplot(y = data.brasil$cand_winner, x = data.brasil$run, title = "Efecto seguidor",
y.label = "Probabilidad de ganar en t+1",
x.label = "Distancia con respecto al 3er lugar en t")
summary(rdres)
rdres$rdplot
summary(rdbwselect(y = data.brasil$cand_winner,
x = data.brasil$run,
kernel = 'uniform',
cluster=data.brasil$id_munic, all=T))
rd5 <- felm(cand_winner ~ D  + run |0 | 0 | id_munic, data=subset(data.brasil,bw<12.57))
rd6 <- felm(cand_winner ~ D  + run |0 | 0 | id_munic, data=subset(data.brasil,bw<12.57/2))
rd7 <- felm(cand_winner ~ D  + run |0 | 0 | id_munic, data=subset(data.brasil,bw<12.57*2))
tab2 <- stargazer(rd5, rd6, rd7,
title="Comparación de especificaciones de RD (2)", type="text",
df=FALSE, digits=2)
blogdown:::preview_site()
