coeftest(dreg, vcov = vcovHC(dreg, type="HC1"))[1:2,]
#CR0 implementa la corrección de sándwich para errores agrupados
coef_test(dreg,
vcov = "CR0",
cluster = data.morocco$demi_paire)[1:2,]
?vcovHC
?vcov
?vcovCR
#Coleccionamos con stargazer
stargazer(dreg, dreg, dreg,
type = "html",
se = list(sqrt(diag(vcovHC(dreg, type = "HC0"))),
sqrt(diag(vcovHC(dreg, type = "CR0"))),
sqrt(diag(vcovHC(dreg, type = "CR1S")))),
column.labels =c("HC0", "CR0", "CR1S"),
keep = c("treatment"))
#Coleccionamos con stargazer
stargazer(dreg, dreg, dreg,
type = "html",
se = list(sqrt(diag(vcovHC(dreg, type = "HC0"))),
sqrt(diag(vcovCR (dreg, type = "CR0"))),
sqrt(diag(vcovCR (dreg, type = "CR1S")))),
column.labels =c("HC0", "CR0", "CR1S"),
keep = c("treatment"))
#Coleccionamos con stargazer
stargazer(dreg, dreg, dreg,
type = "html",
se = list(sqrt(diag(vcovHC(dreg, type = "HC0"))),
sqrt(diag(vcovCR (dreg, type = "CR0", cluster= data.morocco$demi_paire))),
sqrt(diag(vcovCR (dreg, type = "CR1S", cluster= data.morocco$demi_paire)))),
column.labels =c("HC0", "CR0", "CR1S"),
keep = c("treatment"))
source("C:/Users/rojas/Dropbox/curso_EPS/eps-2022/content/laboratorios/lab_late_r.R", echo=TRUE)
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
library(janitor)
library(sandwich)
library(clubSandwich)
library(stargazer)
library(lmtest)
#Experimento con cumplimiento imperfecto ----
data.morocco<-read_csv("./content/laboratorios/crepon_morocco.csv",
locale = locale(encoding = "latin1"))   %>%
clean_names() %>%
filter(merge_indicator!=1)   # 2 y 3 incluyen la línea base
#Asignación: treatment
#Cumplimiento: client
#Estadística por grupo de treatment de head_age_bl
data.morocco %>%
group_by(treatment) %>%
summarize(mean=mean(head_age_bl),
std=sd(head_age_bl), n=n()) %>%
ungroup()
#Con una regresión:
dreg <- lm(head_age_bl ~ treatment + factor(paire), data=data.morocco)
#Pongamos atención al valor p
summary(dreg)$coef[1:2,]
nobs(dreg)
#Errores estándar agrupados----
#Ignorando la agrupación
coeftest(dreg, vcov = vcovHC(dreg, type="HC1"))[1:2,]
#CR0 implementa la corrección de sándwich para errores agrupados
coef_test(dreg,
vcov = "CR0",
cluster = data.morocco$demi_paire)[1:2,]
#Errores CR1S, que significan clustered roubst "Stata" :3
coef_test(dreg,
vcov = "CR1S",
cluster = data.morocco$demi_paire)[1:2,]
#Coleccionamos con stargazer
stargazer(dreg, dreg, dreg,
type = "text",
se = list(sqrt(diag(vcovHC(dreg, type = "HC0"))),
sqrt(diag(vcovCR (dreg, type = "CR0", cluster= data.morocco$demi_paire))),
sqrt(diag(vcovCR (dreg, type = "CR1S", cluster= data.morocco$demi_paire)))),
column.labels =c("HC0", "CR0", "CR1S"),
keep = c("treatment"))
#Coleccionamos con stargazer
stargazer(dreg, dreg, dreg,
type = "text",
se = list(sqrt(diag(vcovHC(dreg, type = "HC0"))),
sqrt(diag(vcovCR (dreg, type = "CR0", cluster= data.morocco$demi_paire))),
sqrt(diag(vcovCR (dreg, type = "CR1S", cluster= data.morocco$demi_paire)))),
column.labels =c("HC0", "CR0", "CR1S"),
se = FALSE,
p = TRUE,
keep = c("treatment"))
#Coleccionamos con stargazer
stargazer(dreg, dreg, dreg,
type = "text",
se = list(sqrt(diag(vcovHC(dreg, type = "HC0"))),
sqrt(diag(vcovCR (dreg, type = "CR0", cluster= data.morocco$demi_paire))),
sqrt(diag(vcovCR (dreg, type = "CR1S", cluster= data.morocco$demi_paire)))),
column.labels =c("HC0", "CR0", "CR1S"),
keep = c("treatment"))
#Coleccionamos con stargazer
stargazer(dreg, dreg, dreg,
type = "text",
se = list(sqrt(diag(vcovHC(dreg, type = "HC0"))),
sqrt(diag(vcovCR (dreg, type = "CR0", cluster= data.morocco$demi_paire))),
sqrt(diag(vcovCR (dreg, type = "CR1S", cluster= data.morocco$demi_paire)))),
column.labels =c("HC0", "CR0", "CR1S"),
p = TRUE,
keep = c("treatment"))
#Coleccionamos con stargazer
stargazer(dreg, dreg, dreg,
type = "text",
se = list(sqrt(diag(vcovHC(dreg, type = "HC0"))),
sqrt(diag(vcovCR (dreg, type = "CR0", cluster= data.morocco$demi_paire))),
sqrt(diag(vcovCR (dreg, type = "CR1S", cluster= data.morocco$demi_paire)))),
column.labels =c("HC0", "CR0", "CR1S"),
report=("vc*p"),
keep = c("treatment"))
xaringan::infinite_moon_reader()
options(digits=3)
sample
?sample
#Ciclos
#Si quiero hacer lo mismo, digamos 10 veces
reps=10
resultados <- data.frame(medias=matrix(ncol = 1, nrow = reps))
for (i in 1:reps)
{
data.b <- data.morocco[sample(nrow(data.morocco),
obs,
replace = TRUE), ]
#Guardamos en cada entrada la media estimada
resultados[i,1] <- mean(data.b$expense_total)
}
set.seed(927)
data.morocco <- read.csv("./crepon_morocco_analysis.csv") %>%
select(treatment, client, expense_total)
set.seed(927)
data.morocco <- read.csv("/.content/laboratorios/crepon_morocco_analysis.csv") %>%
select(treatment, client, expense_total)
data.morocco <- read.csv("./content/laboratorios/crepon_morocco_analysis.csv") %>%
select(treatment, client, expense_total)
data.morocco <- read.csv("./content/laboratorios/crepon_morocco_analysis.csv") %>%
select(treatment, client, expense_total)
set.seed(927)
data.morocco<-read_csv("./content/laboratorios/crepon_morocco.csv",
locale = locale(encoding = "latin1"))   %>%
obs <- nrow(data.morocco)
data.morocco<-read_csv("./content/laboratorios/crepon_morocco.csv",
locale = locale(encoding = "latin1"))   %>%
obs <- nrow(data.morocco)
set.seed(927)
data.morocco<-read_csv("./content/laboratorios/crepon_morocco.csv",
locale = locale(encoding = "latin1"))
obs <- nrow(data.morocco)
obs
#Veamos la media del gasto total
mean(data.morocco$expense_total)
#Veamos la media del gasto total
mean(data.morocco$expense_total, na.rm=T)
#Una muestra bootstrap
data.b <- data.morocco[sample(nrow(data.morocco),
obs,
replace = TRUE), ]
mean(data.b$expense_total, na.rm=T)
# Otra muestra bootstrap
data.b <- data.morocco[sample(nrow(data.morocco),
obs,
replace = TRUE), ]
mean(data.b$expense_total, na.rm=T)
#Ciclos
#Si quiero hacer lo mismo, digamos 10 veces
reps=10
resultados <- data.frame(medias=matrix(ncol = 1, nrow = reps))
for (i in 1:reps)
{
data.b <- data.morocco[sample(nrow(data.morocco),
obs,
replace = TRUE), ]
#Guardamos en cada entrada la media estimada
resultados[i,1] <- mean(mean(data.b$expense_total, na.rm=T))
}
View(resultados)
View(resultados)
#Ciclos
#Si quiero hacer lo mismo, digamos 10 veces
reps=10
resultados <- data.frame(medias=matrix(ncol = 1, nrow = reps))
for (i in 1:reps)
{
data.b <- data.morocco[sample(nrow(data.morocco),
obs,
replace = TRUE), ]
#Guardamos en cada entrada la media estimada
resultados[i,1] <- mean(data.b$expense_total, na.rm=T)
}
View(resultados)
View(resultados)
xaringan::infinite_moon_reader()
xaringan::infinite_moon_reader()
xaringan::infinite_moon_reader()
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
library(janitor)
library(sandwich)
library(clubSandwich)
library(stargazer)
library(lmtest)
#Experimento con cumplimiento imperfecto ----
data.morocco<-read_csv("./content/laboratorios/crepon_morocco.csv",
locale = locale(encoding = "latin1"))   %>%
clean_names() %>%
filter(merge_indicator!=1)   # 2 y 3 incluyen la línea base
#Asignación: treatment
#Cumplimiento: client
#Estadística por grupo de treatment de head_age_bl
data.morocco %>%
group_by(treatment) %>%
summarize(mean=mean(head_age_bl),
std=sd(head_age_bl), n=n()) %>%
ungroup()
#Con una regresión:
dreg <- lm(head_age_bl ~ treatment + factor(paire), data=data.morocco)
#Pongamos atención al valor p
summary(dreg)$coef[1:2,]
nobs(dreg)
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
library(janitor)
library(sandwich)
library(clubSandwich)
library(stargazer)
library(lmtest)
#Experimento con cumplimiento imperfecto ----
data.morocco<-read_csv("./content/laboratorios/crepon_morocco.csv",
locale = locale(encoding = "latin1"))   %>%
clean_names() %>%
filter(merge_indicator!=1)   # 2 y 3 incluyen la línea base
#Asignación: treatment
#Cumplimiento: client
#Estadística por grupo de treatment de head_age_bl
data.morocco %>%
group_by(treatment) %>%
summarize(mean=mean(head_age_bl),
std=sd(head_age_bl), n=n()) %>%
ungroup()
#Con una regresión:
dreg <- lm(head_age_bl ~ treatment + factor(paire), data=data.morocco)
#Pongamos atención al valor p
summary(dreg)$coef[1:2,]
nobs(dreg)
#Pongamos atención al valor p
print(summary(dreg)$coef[1:2,], digits=3)
#Pongamos atención al valor p
print(summary(dreg)$coef[1:2,], digits=3)
#Pongamos atención al valor p
summary(dreg)$coef[1:2,]
#Pongamos atención al valor p
round(summary(dreg)$coef[1:2,])
#Pongamos atención al valor p
round(summary(dreg)$coef[1:2,], 2)
#Pongamos atención al valor p
round(summary(dreg)$coef[1:2,], 4)
?round
#Pongamos atención al valor p
round(summary(dreg)$coef[1:2,], digits=4)
blogdown:::preview_site()
xaringan::infinite_moon_reader()
blogdown::build_site()
xaringan::infinite_moon_reader()
blogdown::build_site()
install.packages('tidy')
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::serve_site()
blogdown:::preview_site()
blogdown::build_site()
blogdown::serve_site()
blogdown:::preview_site()
blogdown:::preview_site()
blogdown::serve_site()
blogdown::stop_server()
blogdown::build_site()
xaringan::infinite_moon_reader()
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
#Datos
data.pvalues<-read_csv("./data_benjamini_hochberg.csv",
locale = locale(encoding = "latin1"))
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
#Datos
data.pvalues<-read_csv(".laboratorios/data_benjamini_hochberg.csv",
locale = locale(encoding = "latin1"))
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
#Datos
data.pvalues<-read_csv("./laboratorios/data_benjamini_hochberg.csv",
locale = locale(encoding = "latin1"))
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
#Datos
data.pvalues<-read_csv("./content/laboratorios/data_benjamini_hochberg.csv",
locale = locale(encoding = "latin1"))
n <- 15
alpha <- 0.05
data.pvalues
View(data.pvalues)
View(data.pvalues)
p_al_menos_1error <- 1-(1-alpha)^m
m <- 1:100
p_al_menos_1error <- 1-(1-alpha)^m
plot(p_al_menos_1error)
knitr::opts_chunk$set(echo = FALSE, fig.path = "figures/")
library(tidyverse)
library(janitor)
library(sandwich)
#library(nnet)
#library(mlogit)
library(readr)
library(clubSandwich)
library(modelsummary)
library(estimatr)
xfun::pkg_load2(c('base64enc', 'htmltools', 'mime'))
alpha=0.05
n <- 1:1000
p <- 1-(1-alpha)^n
plot(p,n, xlab="n", ylab="1-(1-alpha)^n")
alpha=0.05
n <- 1:100
p <- 1-(1-alpha)^n
plot(p,n, xlab="n", ylab="1-(1-alpha)^n")
alpha <- 0.05
n <- 1:100
p <- 1-(1-alpha)^n
plot(p,n, xlab="n", ylab="1-(1-alpha)^n")
#Datos
data.pvalues<-read_csv("./content/laboratorios/data_benjamini_hochberg.csv",
locale = locale(encoding = "latin1"))
m <- 15
alpha <- 0.05
data.pvalues
#Bonferroni----
data.bonferroni <- data.pvalues %>%
mutate(bonferroni_alpha=alpha/m) %>%
mutate(bonferrini_rechazar=ifelse(poriginal<=bonferroni_alpha,1,0))
#Benjamini-Hochberg----
data.bh <- data.pvalues %>%
mutate(bh_alpha=alpha*hipotesis/m) %>%
mutate(bh_rechazar=ifelse(poriginal<=bh_alpha,1,0))
View(data.bh)
View(data.bh)
alpha <- 0.05
m <- 1:100
p <- 1-(1-alpha)^m
plot(p,m, xlab="n", ylab="1-(1-alpha)^m")
alpha <- 0.05
m <- 1:100
p <- 1-(1-alpha)^m
plot(p,m, xlab="n", ylab="1-(1-alpha)^m")
alpha <- 0.05
m <- 1:100
p <- 1-(1-alpha)^m
plot(p,m, xlab="n", ylab="1-(1-alpha)^m")
alpha <- 0.05
m <- 1:100
p <- 1-(1-alpha)^m
plot(m,p, xlab="n", ylab="1-(1-alpha)^m")
xaringan::infinite_moon_reader()
?vcov
?vcovCR
install.packages(ggbrace)
devtools::install_github("nicolash2/ggbrace")
install.packages('devtools')
devtools::install_github("nicolash2/ggbrace")
blogdown:::preview_site()
blogdown:::preview_site()
knitr::opts_chunk$set(collapse = TRUE)
library(tidyverse)
library(janitor)
library(sandwich)
library(readr)
library(clubSandwich)
library(modelsummary)
library(estimatr)
library(lubridate)
library(ExPanDaR) #for describing panel data
library(lfe)
library(ggbrace)
knitr::include_graphics("./banks_map.png")
banks<-read_csv("./banks_mm.csv",
locale = locale(encoding = "latin1"))
banks <- banks %>%
filter(month(date) == 7L,
mday(date) == 1L) %>%
mutate(year = year(date)) %>%
select(year,
matches("bi[ob][68]")) %>%
select(year,bib6,bib8) %>%
gather(distrito,banks,bib6:bib8) %>%
mutate(treatment=ifelse(distrito=="bib6",1,0)) %>%
mutate(post=ifelse(year>=1931,1,0))
banks %>%
mutate(banks=ifelse(year==1930 | year==1931,banks,NA)) %>%
filter(year <= 1932) %>%
ggplot(aes(x=year, y=banks, color=distrito)) +
geom_line(size=2) +
scale_y_continuous(limits=c(100,180))
banks_contrafactual <- banks %>%
mutate(banks=ifelse(year==1930 | year==1931,banks,NA)) %>%
filter(year <= 1932) %>%
mutate(tipo="observado")
d6_contrafactual <- banks_contrafactual %>%
filter(distrito=="bib6") %>%
mutate(banks=ifelse(year==1931,102,banks),
tipo="contrafactual")
banks_contrafactual <- rbind(banks_contrafactual,d6_contrafactual)
banks_contrafactual %>%
ggplot(aes(x=year, y=banks, color=distrito, linetype=tipo))+
geom_line(size=2) +
scale_linetype_manual(values=c("dashed", "solid")) +
scale_y_continuous(limits=c(100,180))+
geom_brace(aes(c(1931.1,1931.3), c(121,102), label="Efecto del\ntratamiento"), inherit.data=F, labelsize=3, rotate = 90)
summary(lm(banks ~ treatment + post+ treatment*post,
data=banks))
summary(lm(banks ~ treatment + post+ treatment*post,
data=filter(banks,year==1930 | year==1931)))
summary(lm(banks ~ treatment + post+ treatment*post,
data=banks))
View(banks)
View(banks)
?lfe
install.packages('plm')
library(plm)
?plm
summary(plm(inv~treatment,
index = c("distrito","year"),
data = banks,
model = "within"))
summary(plm(banks ~ treatment,
index = c("distrito","year"),
data = banks,
model = "within"))
summary(plm(banks ~ treatment,
index = c("distrito","year"),
data = banks,
model = "within"))
plm(banks ~ treatment,
index = c("distrito","year"),
data = banks,
model = "within")
summary(plm(bbanks$banks ~ treatment,
index = c("distrito","year"),
data = banks,
model = "within"))
summary(plm(banks$banks ~ treatment,
index = c("distrito","year"),
data = banks,
model = "within"))
summary(plm(banks ~ treatment,
index = c("distrito","year"),
data = banks,
model = "within"))
summary(plm(formula = banks ~ treatment,
index = c("distrito","year"),
data = banks,
model = "within"))
summary(plm(formula = banks ~ treatment,
data = banks,
model = "within"))
summary(plm(formula = banks ~ treatment,
data = banks,
model = "within",
index = c("distrito","year")))
summary(plm(formula = banks ~ treatment,
data = banks,
model = "within",
index = c("year","distrito")))
summary(plm(formula = banks ~ 1+  treatment,
data = banks,
model = "within",
index = c("year","distrito")))
summary(plm(formula = banks ~  treatment*post,
data = banks,
model = "within",
index = c("year","distrito")))
summary(plm(formula = banks ~  treatment*post,
data = banks,
model = "within",
index = c("distrito","year")))
summary(plm(formula = banks ~ 1 + treatment*post,
data = banks,
model = "within",
index = c("distrito","year")))
