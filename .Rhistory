acafs <- data.frame(read.dta13('./tareas/content/tareas/tarea_3/ehec_data.dta'))
acafs <- data.frame(read.dta13('./content/tareas/content/tareas/tarea_3/ehec_data.dta'))
install.packages('read.dta13')
library(readstata13)
install.packages('readstata13')
library(readstata13)
library(statar)
??statar
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
library(readr)
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv")
install.packages('rdrobust')
library(rdrobust)
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv")
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv") %>%
filter(formal==1)
View(salud)
View(salud)
View(salud)
View(salud)
(rdplot(y = salud$gastosalud,
x = salud$ifh,
c=55,
p=2))
?rdplot
(rdplot(y = salud$gastosalud,
x = salud$ifh,
c=55,
p=2,
subset = high==0))
(rdplot(y = salud$gastosalud,
x = salud$ifh,
c=55,
p=2,
subset =c(high==0)))
(rdplot(y = salud$gastosalud,
x = salud$ifh,
c=55,
p=2,
subset =c(alto_electricidad==0)))
(rdplot(y = salud$gastosalud,
x = salud$ifh,
c=55,
p=2,
subset =c("alto_electricidad==0")))
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv") %>%
filter(formal==1) %>%
mutate(score_norm=ifh-corte)
(rdplot(y = salud$gastosalud,
x = salud$score_norm,
c=0,
p=2))
(rdplot(y = salud$gastosalud,
x = salud$score_norm,
c=0,
p=1))
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
library(readr)
library(rdrobust)
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv") %>%
filter(formal==1) %>%
mutate(score_norm=ifh-corte)
(rdplot(y = salud$curative,
x = salud$score_norm,
c=0,
p=1))
?rdplot
#Versión simple de RD
summary(lm(consulta ~ score_norm + arriba_corte + score_norm*arriba_corte,
data=data.hs))
#Versión simple de RD
summary(lm(consulta ~ score_norm + arriba_corte + score_norm*arriba_corte,
data=salud))
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv") %>%
filter(formal==1) %>%
mutate(score_norm=ifh-corte,
arriba_corte=ifelse(ifh>corte, 1, 0))
#Versión simple de RD
summary(lm(consulta ~ score_norm + arriba_corte + score_norm*arriba_corte,
data=salud))
summary(lm(consulta ~ score_norm + arriba_corte + score_norm*arriba_corte,
data=filter(salud, score_norm>=-20 & score_norm <=20))
)
summary(saldud$score_norm)
summary(salud$score_norm)
summary(lm(consulta ~ score_norm + arriba_corte + score_norm*arriba_corte,
data=filter(salud, score_norm>=-20 & score_norm <=20)))
#Versión simple de RD
summary(lm(consulta ~ score_norm + arriba_corte + score_norm*arriba_corte,
data=filter(salud, score_norm>=-20 & score_norm <=20 & high==0)))
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv") %>%
filter(formal==0) %>%
mutate(score_norm=ifh-corte,
arriba_corte=ifelse(ifh>corte, 1, 0))
#Versión simple de RD
summary(lm(consulta ~ score_norm + arriba_corte + score_norm*arriba_corte,
data=filter(salud, score_norm>=-20 & score_norm <=20 & high==0)))
#Con esto obtenemos el resultado del paper
summary(lm(consulta ~ score_norm + arriba_corte + score_norm*arriba_corte + mujer + edad + educ + mieperho + hhmujer + high*score_norm + high*arriba_corte,
data=filter(salud, score_norm>=-20 & score_norm <=20)))
#Con esto obtenemos el resultado del paper
summary(lm(consulta ~ score_norm + arriba_corte + score_norm*arriba_corte ,
data=filter(salud, score_norm>=-20 & score_norm <=20)))
#Con esto obtenemos el resultado del paper
summary(lm(consulta ~ score_norm + arriba_corte + score_norm*arriba_corte ,
data=filter(salud, score_norm>=-20 & score_norm <=20 & high==0)))
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv") %>%
filter(formal==0) %>%
mutate(score_norm=ifh-corte,
arriba_corte=ifelse(ifh<=corte, 1, 0))
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv") %>%
filter(formal==0) %>%
mutate(ifh_norm=ifh-corte,
abajo_corte=ifelse(ifh<=corte, 1, 0))
#Con esto obtenemos el resultado del paper
summary(lm(consulta ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte + mujer + edad + educ + mieperho + hhmujer + high*ifh_norm + high*abajo_corte ,
data=filter(salud, score_norm>=-20 & score_norm <=20 & high==0)))
#Con esto obtenemos el resultado del paper
summary(lm(consulta ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte + mujer + edad + educ + mieperho + hhmujer + high*ifh_norm + high*abajo_corte ,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Con esto obtenemos el resultado del paper
summary(lm(consulta ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte + mujer + edad + educ + mieperho + hhmujer + high*ifh_norm + high*abajo_corte ,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20)))
#Versión simple de RD
summary(lm(consulta ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Con esto obtenemos el resultado del paper
summary(lm(consulta ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte + mujer + edad + educ + mieperho + hhmujer + high*ifh_norm + high*abajo_corte ,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20)))
#Con esto obtenemos el resultado del paper
summary(lm(hospinter ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte + mujer + edad + educ + mieperho + hhmujer + high*ifh_norm + high*abajo_corte ,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20)))
#Versión simple de RD
summary(lm(hospinter ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Restringiendo la ventana
summary(lm(hospinter ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte,
data=filter(salud, ifh_norm>=-10 & ifh_norm <=10 & high==0)))
summary(rdrobust(y=salud$hospinter,
x=salud$ifh,
c=55))
summary(rdrobust(y=filter(salud, high==0)$hospinter,
x=filter(salud, high==0)$ifh,
c=55))
#Elección de la ventana sin covariables (Columna 1, panel superior)
summary(rdrobust(y=filter(salud, high==0)$gastosalud2,
x=filter(salud, high==0)$ifh,
c=55))
#Elección de la ventana sin covariables (Columna 1, panel superior)
summary(rdrobust(y=filter(salud, high==0)$gastosalud2,
x=filter(salud, high==0)$ifh,
c=55,
rho=1))
summary(lm(hospinter ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte,
data=filter(salud, ifh_norm>=-10 & ifh_norm <=10 & high==0)))
#Versión simple de RD
summary(lm(hospinter ~ ifh_norm + abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Restringinedo la ventana
summary(lm(hospinter ~ ifh_norm + abajo_corte,
data=filter(salud, ifh_norm>=-10 & ifh_norm <=10 & high==0)))
#Pendiente diferente antes y después
summary(lm(hospinter ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ ifh_norm:abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ ifh_norm::abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ I(ifh_norm:abajo_corte),
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ I(ifh_norm*abajo_corte),
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ I(ifh_norm::abajo_corte),
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ ifh_norm*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ ifh_norm*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ ifh_norm*abajo_corte + I(ifh_norm^2)*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
salud <- salud %>%
filter(high==0)
attach(salud)
summary(rdrobust(y=gastosalud2,
x=ifh,
c=55,
covs = cbind(mujer edad educ mieperho hhmujer)))
summary(rdrobust(y=gastosalud2,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer)))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer)))
?rdrobust
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer),
vce = 'hc0'))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer),
vce = 'hc3'))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer),
vce = 'hc3',
all = T))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ ifh_norm*abajo_corte + I(ifh_norm^2)*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después
summary(lm(hospinter ~ ifh_norm + abajo_corte + ifh_norm*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
#Pendiente diferente antes y después y término cuadrático
summary(lm(hospinter ~ ifh_norm*abajo_corte + I(ifh_norm^2)*abajo_corte,
data=filter(salud, ifh_norm>=-20 & ifh_norm <=20 & high==0)))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer),
vce = 'hc3',
all = T))
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
library(readr)
library(rdrobust)
salud <- read_csv("content/tareas/tarea_3/salud_ecuador.csv") %>%
filter(formal==0) %>%
mutate(ifh_norm=ifh-corte,
abajo_corte=ifelse(ifh<=corte, 1, 0))
(rdplot(y = salud$curative,
x = salud$score_norm,
c=0,
p=1))
(rdplot(y = salud$curative,
x = salud$ifh_norm,
c=0,
p=1))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
vce = 'hc3',
all = T))
summary(rdrobust(y=hospinter,
x=ifh,
c=55,
covs = cbind(mujer, edad, educ, mieperho, hhmujer),
vce = 'hc3',
all = T))
knitr::opts_chunk$set(echo = T, warning = F, message = F)
library(tidyverse)
library(janitor)
library(clubSandwich)
library(modelsummary)
library(MatchIt)
library(Zelig)
devtools::install_github('IQSS/Zelig')
knitr::opts_chunk$set(echo = T, warning = F, message = F)
library(tidyverse)
library(janitor)
library(clubSandwich)
library(modelsummary)
library(MatchIt)
library(Zelig)
data.smoking<-read_csv(
"./cattaneo_smoking.csv",
locale = locale(encoding = "latin1")) %>%
clean_names() %>%
mutate(smoke=ifelse(mbsmoke=="smoker",1,0)) %>%
mutate(married=ifelse(mmarried=="married",1,0)) %>%
mutate(firstbaby=ifelse(fbaby=="Yes",1,0))
#Asegurarse que no hay NA, matchit no acepta NA
data.smoking <- data.smoking[complete.cases(data.smoking), ]
#Una semilla para todo el trabajo
set.seed(1021)
datasummary_balance(~smoke,
fmt = "%.2f",
data = select(data.smoking),
dinm_statistic = "p.value"
title = "Pruebas de balance",
datasummary_balance(~smoke,
fmt = "%.2f",
data = select(data.smoking),
dinm_statistic = "p.value",
title = "Pruebas de balance",
notes = "Fuente: Cattaneo (2009)")
datasummary_balance(~smoke,
fmt = "%.2f",
data = select(data.smoking, married, firstbaby, medu, nprenatal, foreign, mhisp, fage),
dinm_statistic = "p.value",
title = "Pruebas de balance",
notes = "Fuente: Cattaneo (2009)")
datasummary_balance(~smoke,
fmt = "%.2f",
data = select(data.smoking, smoke, married, firstbaby, medu, nprenatal, foreign, mhisp, fage),
dinm_statistic = "p.value",
title = "Pruebas de balance",
notes = "Fuente: Cattaneo (2009)")
binaria <- "smoke"
variables <- c("married", "firstbaby", "medu", "nprenatal", "foreign", "mhisp", "fage")
ps <- as.formula(paste(binaria,
paste(variables,
collapse ="+"),
sep= " ~ "))
print(ps)
m.out <- matchit(formula=ps,
method = "nearest",
ratio = 1,
distance= "logit",
replace = FALSE,
data = data.smoking)
summary(m.out)
plot(m.out, type = "jitter")
plot(m.out, type = "hist")
m.data <- match.data(m.out)
head(m.out$match.matrix)
z.out <- zelig(bweight~smoke,
data = m.data,
model = "ls")
z.out
summary(lm(bweight ~ smoke,
data = m.data))
library(cobalt)
love.plot(bal.tab(m.out),
threshold = .1)
blogdown:::preview_site()
knitr::opts_chunk$set(echo = T, warning = F, message = F)
library(tidyverse)
library(janitor)
library(clubSandwich)
library(modelsummary)
library(MatchIt)
library(Zelig)
library(cobalt)
data.smoking<-read_csv(
"./cattaneo_smoking.csv",
locale = locale(encoding = "latin1")) %>%
clean_names() %>%
mutate(smoke=ifelse(mbsmoke=="smoker",1,0)) %>%
mutate(married=ifelse(mmarried=="married",1,0)) %>%
mutate(firstbaby=ifelse(fbaby=="Yes",1,0))
#Asegurarse que no hay NA, matchit no acepta NA
data.smoking <- data.smoking[complete.cases(data.smoking), ]
#Una semilla para todo el trabajo
set.seed(1021)
datasummary_balance(~smoke,
fmt = "%.2f",
data = select(data.smoking, smoke, married, firstbaby, medu, nprenatal, foreign, mhisp, fage),
dinm_statistic = "p.value",
title = "Pruebas de balance",
notes = "Fuente: Cattaneo (2009)")
binaria <- "smoke"
variables <- c("married", "firstbaby", "medu", "nprenatal", "foreign", "mhisp", "fage")
ps <- as.formula(paste(binaria,
paste(variables,
collapse ="+"),
sep= " ~ "))
print(ps)
m.out <- matchit(formula=ps,
method = "nearest",
ratio = 1,
distance= "logit",
replace = FALSE,
data = data.smoking)
summary(m.out)
plot(m.out, type = "jitter")
plot(m.out, type = "hist")
m.data <- match.data(m.out)
head(m.out$match.matrix)
love.plot(bal.tab(m.out),
threshold = .1)
tt1 <- lm(bweight ~ smoke,
data = m.data,
weights = weights)
#Cluster-robust standard errors
coeftest(tt1,
vcov. = vcovCL,
cluster = ~subclass)
library(lmtest)
tt1 <- lm(bweight ~ smoke,
data = m.data,
weights = weights)
#Cluster-robust standard errors
coeftest(tt1,
vcov. = vcovCL,
cluster = ~subclass)
library(sandwich)
tt1 <- lm(bweight ~ smoke,
data = m.data,
weights = weights)
#Cluster-robust standard errors
coeftest(tt1,
vcov. = vcovCL,
cluster = ~subclass)
m.data
a <- m.data
View(a)
View(a)
tt2 <- lm(bweight ~ smoke + married + firstbaby + medu + nprenatal + foreign + mhisp + fage,
data = m.data,
weights = weights)
#Errores agrupados a nivel subclass
coeftest(tt2,
vcov. = vcovCL,
cluster = ~subclass)
m.out <- matchit(formula=ps,
method = "nearest",
distance= "logit",
replace = FALSE,
ratio = 2,
caliper = .1,
data = data.smoking)
m.data <- match.data(m.out)
head(m.out$match.matrix)
love.plot(bal.tab(m.out),
threshold = .1)
tt1 <- lm(bweight ~ smoke,
data = m.data,
weights = weights)
#Errores agrupados a nivel subclass
coeftest(tt1,
vcov. = vcovCL,
cluster = ~subclass)
View(m.data)
# Espacio de trabajo ----
rm(list = ls())
options(scipen=999) # Prevenir notación científica
library(tidyverse)
library(janitor)
library(sandwich)
library(clubSandwich)
library(modelsummary)
library(MatchIt)
library(Zelig)
library(cobalt)
library(lmtest)
#Datos
data.smoking <- read_csv(
"./cattaneo_smoking.csv",
locale = locale(encoding = "latin1")) %>%
clean_names() %>%
mutate(smoke=ifelse(mbsmoke=="smoker",1,0)) %>%
mutate(married=ifelse(mmarried=="married",1,0)) %>%
mutate(firstbaby=ifelse(fbaby=="Yes",1,0))
data.smoking <- read_csv(
"./content/notas/cattaneo_smoking.csv",
locale = locale(encoding = "latin1")) %>%
clean_names() %>%
mutate(smoke=ifelse(mbsmoke=="smoker",1,0)) %>%
mutate(married=ifelse(mmarried=="married",1,0)) %>%
mutate(firstbaby=ifelse(fbaby=="Yes",1,0))
View(data.smoking)
m.out <- matchit(formula=ps,
method = "nearest",
ratio = 1,
distance= "logit",
replace = FALSE,
data = data.smoking)
#Nuestro modelo para el PS----
binaria <- "smoke"
variables <- c("married", "firstbaby", "medu", "nprenatal", "foreign", "mhisp", "fage")
ps <- as.formula(paste(binaria,
paste(variables,
collapse ="+"),
sep= " ~ "))
print(ps)
#Estimación del PS
ps.est <- glm(formula = ps,
family = binomial(link = "logit"),
data = data.smoking)
#El PS estimado es la probabilidad ajustada
data.smoking <- data.smoking %>%
mutate(ps_hat = predict(ps.est, type = "response"))
data.smoking %>%
ggplot(aes(x = ps_hat)) +
geom_histogram(aes(y=..density..), colour="black", fill="white")+
facet_wrap(~smoke) +
xlab("Probabilidad de fumar") +
theme_bw()
#Usaremos la función matchit para hacer el apareamiento----
m.out <- matchit(formula=ps,
method = "nearest",
ratio = 1,
distance= "logit",
replace = FALSE,
data = data.smoking)
summary(m.out)
#Con match.data obtenemos la muestra apareada
m.data <- match.data(m.out)
View(m.data)
View(m.data)
